<h1>PHISH</h1>
<p>There is something phishy going on!</p>

<%product=Product.order('RANDOM()').first%>
<div class = "center">
  <%path = "/products/" + String(product.id)%>
  <div class="grid-container">
  <div class="grid-item">
    <a href=<%=path%>><div class="card">
      <div class="center">
      <img width="300" height= "300" class="center" src=<%=product.imageSource%> >
      <div class="center">
        <b><%=product.name%></b>
      </div>
      </a>
      <div>
        <p class = "center">$<%=product.price%></p>
        <p><%=product.description%></p>
        <input id= <%=product.id%> type="button" onclick="myFunction(<%=product.id%>, this);" />
        <script>
          if (localStorage.getItem(<%=product.id%>) !== null){
            document.getElementById(<%=product.id%>).value = "Saved";
            document.getElementById(<%=product.id%>).style.color = "blue";
          }
          else
          {
            document.getElementById(<%=product.id%>).value = "+";
          }
        </script>
        <input type="button" value = "Add to Cart"/>
      </div>
    </div>
  </div>
  </div>
  </div>
  </div>
<br>
<br>


<%@popular = Product.order('popularityScore DESC')%>
<h2>Popular Items</h2>
<div class="center">
  <%@popular.each do |item| %>
    <%path = "/products/" + String(item.id)%>
    <div class="grid-container">
      <div class="grid-item">
        <a href=<%=path%>>
          <div class="card">
        <div class="center">
        <img width="300" height= "300" class="center" src=<%=item.imageSource%> >
      <div class="center">
        <b><%=item.name%></b>
      </div>
      </a>
      <div>
        <p class = "center">$<%=item.price%></p>
        <p><%=item.description%></p>
        <input id= <%=item.id%> type="button" onclick="myFunction(<%=item.id%>, this);"/>
        <script>
          if (localStorage.getItem(<%=item.id%>) !== null){
            document.getElementById(<%=item.id%>).value = "Saved";
            document.getElementById(<%=item.id%>).style.color = "blue";
          }
          else
          {
            document.getElementById(<%=item.id%>).value = "+";
          }
        </script>
        <input type="button" value = "Add to Cart"/>
      </div>
    </div>
  </div>
  </div>
  </div>
<%end%>
</div>


<script>
      function myFunction(x, elmnt){
      if (localStorage.getItem(x) !== null){
      alert("Removing product " + x + " from saved list");
      localStorage.removeItem(JSON.stringify(x));
      elmnt.value = '+';
      elmnt.style.color = 'black';
    }
    else{
      alert("Product saved with id " + x);
      localStorage.setItem(JSON.stringify(x), JSON.stringify(x));
      elmnt.value = 'Saved';
      elmnt.style.color = 'blue';
    }
    }; 
</script>